<!-- Modal -->
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load('visualization', '1.0', {packages: ['controls']});
    google.load('visualization', '1', {packages: ['table']});
</script>
<script type="text/javascript">


    function drawVisualization(chartType, chartArea, reportUrl, dashboard) {
        $("#" + chartArea).html("");
        $.getJSON(reportUrl, function (data) {
            var table = new google.visualization.DataTable();
            $.each(data.cols, function () {
                table.addColumn.apply(table, this);
            });
            table.addRows(data.rows);

            if (typeof dashboard === "undefined" || dashboard === null) {
                // Do nothing
            }
            else {

                //Define a slider control for the Age column.
                var slider = new google.visualization.ControlWrapper({
                    'controlType': 'ChartRangeFilter',
                    'containerId': 'report_slider',
                    'options': {
                        'filterColumnLabel': 'mes',
                        'ui': {
                            'labelStacking': 'vertical',
                            'chartOptions': {
                                'chartArea': {'height': '90%', 'width': '70%'}
                            }
                        }
                    }
                });
            }


            var container = document.getElementById(chartArea);
            if (typeof dashboard === "undefined" || dashboard === null) {
                switch (chartType) {
                    case 'column':
                        var chart = new google.visualization.ColumnChart(container);
                        break;
                    case 'pie':
                        var chart = new google.visualization.PieChart(container);
                        break;
                    case 'line':
                        var chart = new google.visualization.LineChart(container);
                        break;
                    case 'table':
                        var chart = new google.visualization.Table(container);
                        break;
                    case 'combo':
                        var chart = new google.visualization.ComboChart(container);
                        break;
                    default:
                        var chart = new google.visualization.ColumnChart(container);
                }
            }

            //var formatter = new google.visualization.NumberFormat(
            //        {prefix: 'R$', negativeColor: 'red', negativeParens: true});
            //formatter.format(table, 1);

            if (typeof dashboard === "undefined" || dashboard === null) {
                chart.draw(table, data.options);
            }
            else {
                chart = new google.visualization.ChartWrapper(
                        {
                            'chartType': 'LineChart',
                            'containerId': 'report_zone_1_div',
                            'options': {
                                'width': 800
                            }

                        }
                );
                var chart2 = new google.visualization.ChartWrapper(
                        {
                            'chartType': 'Table',
                            'containerId': 'report_zone_2_div',
                            'options': {
                                'width': 800
                            }

                        }
                );
                var dashboardArea = new google.visualization.Dashboard(document.getElementById('chartsArea'));
                dashboardArea.bind(slider, chart);
                dashboardArea.bind(slider, chart2);
                dashboardArea.draw(table);

                //new google.visualization.Dashboard(document.getElementById('chartsArea')).bind(slider, chart).draw(table, data.options);
            }
        });
    }
</script>

<script type="text/javascript">

    function drawDashboard(reportUrl, filterType, filterColumn, chartType) {
        hideDiv('report_zone_1_div');
        hideDiv('report_zone_2_div');
        hideDiv('report_zone_3_div');
        hideDiv('report_slider');

        $.getJSON(reportUrl, function (data) {
            var table = new google.visualization.DataTable();
            $.each(data.cols, function () {
                table.addColumn.apply(table, this);
            });
            table.addRows(data.rows);

            //Define a slider control for the Age column.
            var slider = new google.visualization.ControlWrapper({
                'controlType': filterType,
                'containerId': 'report_slider',
                'options': {
                    'filterColumnLabel': filterColumn,
                    'ui': {
                        'chartType': 'ComboChart',
                        'labelStacking': 'vertical',
                        'chartOptions': {
                            'chartArea': {'height': '90%', 'width': '70%'}
                        }
                    }
                }
            });
            $.each(data.options, function (key, value) {
                slider.setOption('ui.chartOptions.' + key, value);
            });

            //var formatter = new google.visualization.NumberFormat(
            //        {prefix: 'R$', negativeColor: 'red', negativeParens: true});
            //formatter.format(table, 1);
            var chart = new google.visualization.ChartWrapper(
                    {
                        'chartType': chartType,
                        'containerId': 'report_zone_1_div',
                        'options': {
                            'width': 800
                        }
                    }
            );
            $.each(data.options, function (key, value) {
                chart.setOption(key, value);
            });

            var tableChart = new google.visualization.ChartWrapper(
                    {
                        'chartType': 'Table',
                        'containerId': 'report_zone_2_div',
                        'options': {
                            'width': 800
                        }
                    }
            );

            var dashboardArea = new google.visualization.Dashboard(document.getElementById('chartsArea'));
            dashboardArea.bind(slider, chart);
            dashboardArea.bind(slider, tableChart);
            dashboardArea.draw(table);
        });
    }

</script>

<script type="text/javascript">
    function drawToolbar() {
        var components = [
            {type: 'igoogle', datasource: 'http://spreadsheets.google.com/tq?key=pCQbetd-CptHnwJEfo8tALA&pub=1',
                gadget: 'http://www.google.com/ig/modules/pie-chart.xml',
                userprefs: {'3d': 1}},
            {type: 'html', datasource: 'http://spreadsheets.google.com/tq?key=pCQbetd-CptHnwJEfo8tALA&pub=1'},
            {type: 'csv', datasource: 'http://spreadsheets.google.com/tq?key=pCQbetd-CptHnwJEfo8tALA&pub=1'},
            {type: 'htmlcode', datasource: 'http://spreadsheets.google.com/tq?key=pCQbetd-CptHnwJEfo8tALA&pub=1',
                gadget: 'http://www.google.com/ig/modules/pie-chart.xml'}
        ];

        var container = document.getElementById('toolbar_div');
        google.visualization.drawToolbar(container, components);
    }
    ;
</script>

<script>
    function showReportMenu() {
        $("#reportsSideMenu").show();

        $("#report_slider").html("");
        $("#report_zone_1_div").html("");
        $("#report_zone_2_div").html("");
        $("#report_zone_3_div").html("");
    }

    function hideReportMenu() {
        $("#reportsSideMenu").hide();

        $("#report_slider").html("");
        $("#report_zone_1_div").html("");
        $("#report_zone_2_div").html("");
        $("#report_zone_3_div").html("");
    }

    function hideDiv(divName) {
        $("#" + divName).html("");
    }

</script>


<div class="divWebpageDialog">
  <div id="reportsModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="reportsModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <div class="btn-group">
        <a class="btn" href="#"><i class="icon-print"></i></a>
        <a class="btn" href="#"><i class="icon-list-alt"></i></a>
        <a class="btn" href="#"><i class="icon-calendar"></i></a>
        <div class="text"></div>
      </div>
      <h3 id="reportsModalLabel">Relatórios Mister Business</h3>

    </div>
    <div class="modal-body">
      <div class="tab-content" id="reportsTab">
        <ul class="nav nav-pills">
          <li class="active">
            <a href="#receitas" data-toggle="tab" id="reportsReceita"
               onclick="
               hideReportMenu();
                       drawVisualization('combo', 'report_zone_1_div','<%= lancamentos_reports_receita_realizada_path %>');
                       drawVisualization('pie', 'report_zone_2_div','<%= lancamentos_reports_receita_por_categoria_path %>') ;
                       drawVisualization('pie', 'report_zone_3_div','<%= lancamentos_reports_receita_por_status_path %>');">Receitas</a>
          </li>
          <li><a href="#despesas" data-toggle="tab" id="reportsDespesa"
                 onclick="
                 hideReportMenu();
                         drawVisualization('column', 'report_zone_1_div','<%= lancamentos_reports_despesa_realizada_path %>');
                         drawVisualization('pie', 'report_zone_2_div','<%= lancamentos_reports_despesa_por_categoria_path %>');
                         drawVisualization('pie', 'report_zone_3_div','<%= lancamentos_reports_despesa_por_centrodecusto_path %>');">Despesas</a>
          </li>
          <li><a href="#fluxo" data-toggle="tab" id="reportsCaixa"
                 onclick="hideReportMenu();">Fluxo de caixa</a></li>
          <li><a href="#resultados" data-toggle="tab" id="reportsResultados" onclick="hideReportMenu();">Resultados</a>
          </li>
          <li><a href="#diversos" data-toggle="tab" id="reportsDiversos" onclick="showReportMenu()">Diversos</a></li>
        </ul>
      </div>
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span2">
            <ul class="nav nav-list" id="reportsSideMenu">
              <li class="nav-header">Receita</li>
              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_contas_a_receber_chart_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_contas_a_receber_table_path %>');">Contas
                a receber</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_recebimentos_atrasados_chart_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_recebimentos_atrasados_table_path %>');">Recebimentos
                atrasados</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_top_receitas_chart_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_top_receitas_table_path %>');">TOP
                receitas</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_receitas_por_categoria_table_path %>');
                             hideDiv('report_zone_2_div');

                     ">Receitas por categoria</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_receitas_por_status_table_path %>');
                             hideDiv('report_zone_2_div');">Receitas
                por status</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_receitas_por_centrodecusto_table_path %>');
                             hideDiv('report_zone_2_div');">Receitas
                por centro de custo</a></li>
              <li><a href="#"
                     onclick="drawDashboard('<%= lancamentos_reports_prazo_medio_recebimento_path %>','ChartRangeFilter','mes', 'LineChart');">Prazo
                médio de recebimento</a></li>
              <li><a href="#"
                     onclick="drawDashboard('<%= lancamentos_reports_ticket_medio_vendas_path %>','ChartRangeFilter','mes', 'LineChart');">Ticket
                médio das vendas</a></li>

              <li class="nav-header">Despesa</li>

              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_contas_a_pagar_chart_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_contas_a_pagar_table_path %>');">Contas
                a pagar</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_contas_vencidas_chart_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_contas_vencidas_table_path %>');">Contas
                Vencidas
              </a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_top_despesas_chart_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_top_despesas_table_path %>');">TOP
                despesas</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_despesas_por_categoria_table_path %>');
                             hideDiv('report_zone_2_div');">Despesas
                por categoria</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_despesas_por_status_table_path %>');
                             hideDiv('report_zone_2_div');">Despesas
                por status</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_despesas_por_centrodecusto_table_path %>');
                             hideDiv('report_zone_2_div');">Despesas
                por centro de custo</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('line', 'report_zone_1_div','<%= lancamentos_reports_prazo_medio_pagamento_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_prazo_medio_pagamento_path %>');">Prazo
                médio de pagamento</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('column', 'report_zone_1_div','<%= lancamentos_reports_aderencia_path %>');
                             drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_aderencia_path %>');">Aderência</a>
              </li>
              <li class="nav-header">Outros</li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= lancamentos_reports_ultimos_lancamentos_path %>');
                             hideDiv('report_zone_2_div');">Ultimos Lancamentos</a></li>
              <li><a href="#"
                     onclick="drawDashboard('<%= lancamentos_reports_lancamentos_futuros_path %>','ChartRangeFilter','mes', 'ComboChart','1', 'bars' );">Lançamentos
                Futuros</a></li>
              <li><a href="#"
                    onclick="drawVisualization('combo', 'report_zone_1_div','<%= lancamentos_reports_lancamentos_futuros_path %>');
                            drawVisualization('table','report_zone_2_div','<%= lancamentos_reports_lancamentos_futuros_path %>');">Lancamentos Futuros2</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= categories_reports_categories_lista_path %>');
                             hideDiv('report_zone_2_div');">Lista de categorias</a></li>
              <li><a href="#"
                     onclick="
                     drawVisualization('table','report_zone_1_div','<%= centrodecustos_reports_centrodecustos_lista_path %>');
                             hideDiv('report_zone_2_div');">Lista de Centros de custo</a></li>

            </ul>
          </div>
          <div id="chartsArea" class="span10">
            <div id="message_div"></div>
            <div id="toolbar_div"></div>
            <div id="report_zone_1_div"></div>
            <div id="report_slider" style="height: 50px;"></div>
            <div id="report_zone_2_div" style="float:left"></div>
            <div>&nbsp; </div>
            <div id="report_zone_3_div" style="float: left"></div>
            <div>&nbsp; </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal">Close</button>
    </div>
  </div>
</div>